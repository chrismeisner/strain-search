<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Cannabis Strain Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
	async function submitPrompt() {
	  const inputField = document.getElementById('strainInput').value.trim();
	  if (!inputField) {
		alert('Please enter a strain name! ğŸŒ¿');
		return;
	  }

	  const prompt = `Find detailed information about the cannabis strain, ${inputField}, including:
	  
1. Popularity (how common or rare is it?)
2. Genetics (parent strains if any)
3. Category (Indica, Sativa, Hybrid, etc.)
4. Effects with emojis (1-3 per effect) and short blurbs
5. Growing information
6. Terpenes (bullet points)
7. Notes (Lemon, Wood, Berry, etc.) with emojis
8. 40-word description
9. Alternative names (3-5 similar options)
10. Confidence score between 1-100 (how reliable the data is)`;

	  const responseDiv = document.getElementById('response');
	  responseDiv.innerHTML = 'Loading... â³';

	  try {
		// Send both user input and prompt to the backend
		const res = await fetch('/api/chat', {
		  method: 'POST',
		  headers: { 'Content-Type': 'application/json' },
		  body: JSON.stringify({ userInput: inputField, prompt }),
		});

		const data = await res.json();
		const fullResponse = data.response;
		console.log("ğŸ” Full Response from API:", fullResponse);

		responseDiv.innerHTML = `<h3 class="text-lg font-semibold">Full Response</h3>
		  <p class="whitespace-pre-line">${fullResponse}</p>`;

		const parsedData = parseResponse(fullResponse);
		displayParsedData(parsedData);
	  } catch (error) {
		console.error("âŒ Error:", error.message);
		responseDiv.innerHTML = `<p class="text-red-500">Error: ${error.message} ğŸš¨</p>`;
	  }
	}

	function parseResponse(responseText) {
	  console.log("ğŸ› ï¸ Parsing Response...");
	  const data = {};

	  data.popularity = responseText.match(/Popularity:\s*(.+)/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ Popularity:", data.popularity);

	  data.genetics = responseText.match(/Genetics:\s*(.+)/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ Genetics:", data.genetics);

	  data.category = responseText.match(/Category:\s*(.+)/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ Category:", data.category);

	  data.effects = responseText.match(/Effects:\s*([\s\S]*?)\n\n/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ Effects:", data.effects);

	  data.growingInfo = responseText.match(/Growing Information:\s*([\s\S]*?)\n\n/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ Growing Information:", data.growingInfo);

	  data.terpenes = responseText.match(/Terpenes:\s*([\s\S]*?)\n\n/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ Terpenes:", data.terpenes);

	  data.notes = responseText.match(/Notes:\s*([\s\S]*?)\n\n/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ Notes:", data.notes);

	  data.description = responseText.match(/40-word Description:\s*(.+)/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ 40-word Description:", data.description);

	  data.altNames = responseText.match(/Alternative Names:\s*([\s\S]*?)\n\n/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ Alternative Names:", data.altNames);

	  data.confidence = responseText.match(/Confidence Score:\s*(.+)/i)?.[1] || 'N/A';
	  console.log("ğŸŸ¢ Confidence Score:", data.confidence);

	  console.log("âœ… Parsing Completed:", data);
	  return data;
	}

	function displayParsedData(parsedData) {
	  const parsedDiv = document.getElementById('parsed-data');
	  parsedDiv.innerHTML = `
		<h3 class="text-lg font-semibold mt-4">Parsed Data</h3>
		<p><span class="font-semibold">Popularity:</span> ${parsedData.popularity}</p>
		<p><span class="font-semibold">Genetics:</span> ${parsedData.genetics}</p>
		<p><span class="font-semibold">Category:</span> ${parsedData.category}</p>
		<p><span class="font-semibold">Effects:</span><br>${parsedData.effects.replace(/\n/g, '<br>')}</p>
		<p><span class="font-semibold">Growing Information:</span><br>${parsedData.growingInfo.replace(/\n/g, '<br>')}</p>
		<p><span class="font-semibold">Terpenes:</span><br>${parsedData.terpenes.replace(/\n/g, '<br>')}</p>
		<p><span class="font-semibold">Notes:</span><br>${parsedData.notes.replace(/\n/g, '<br>')}</p>
		<p><span class="font-semibold">40-word Description:</span> ${parsedData.description}</p>
		<p><span class="font-semibold">Alternative Names:</span><br>${parsedData.altNames.replace(/\n/g, '<br>')}</p>
		<p><span class="font-semibold">Confidence Score:</span> ${parsedData.confidence}</p>`;
	}
  </script>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col items-center p-4">
  <h1 class="text-3xl font-bold text-green-600 my-4 text-center">Cannabis Strain Explorer ğŸŒ¿</h1>
  <p class="text-center max-w-md mb-6">Enter a cannabis strain name below to explore detailed insights about its category, effects, and more.</p>
  <div class="w-full max-w-md">
	<input id="strainInput" type="text" placeholder="Enter strain name (e.g., Durban Poison)"
	  class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-green-400">
	<button onclick="submitPrompt()" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg transition">
	  Search
	</button>
  </div>
  <div id="response" class="w-full max-w-md bg-white shadow-lg rounded-lg p-6 mt-6"></div>
  <div id="parsed-data" class="w-full max-w-md mt-6"></div>
</body>
</html>
